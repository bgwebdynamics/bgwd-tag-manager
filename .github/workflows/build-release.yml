name: Build and Upload Plugin Zip

on:
  release:
    types: [published]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Create Clean Zip
        run: |
          # Create a temporary directory for the build
          mkdir build
          
          # Export the code to the build folder with the correct name
          # git archive allows us to zip it without the .git folders and with a specific prefix
          git archive --format=zip --prefix=bgwd-tag-manager/ HEAD > build/bgwd-tag-manager.zip

      - name: Upload to Release
        uses: softprops/action-gh-release@v1
        if: startsWith(github.ref, 'refs/tags/')
        with:
          files: build/bgwd-tag-manager.zip